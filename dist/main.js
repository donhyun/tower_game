!function(e){var t={};function i(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);var a={};i.r(a),i.d(a,"getCurrentTime",(function(){return n})),i.d(a,"random",(function(){return r})),i.d(a,"randomPositiveNegative",(function(){return s})),i.d(a,"isFunction",(function(){return o})),i.d(a,"isTouchDevice",(function(){return h})),i.d(a,"requestAnimationFrameTool",(function(){return p})),i.d(a,"arraySwap",(function(){return c}));const n=()=>performance.now(),r=(e,t)=>Math.random()*(t-e)+e,s=()=>Math.random()<.5?-1:1,o=e=>"function"==typeof e,h=()=>"ontouchstart"in window||window.navigator.msMaxTouchPoints,p=(()=>{let e=1e3/60;return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(t=>{window.setTimeout(()=>{const i=n();t(i);const a=n();e=1e3/60-(a-i)},e)})})(),c=(e,t,i)=>{const a=e[i];e[i]=e[t],e[t]=a};var d={linear:function(e,t,i,a){return i*e/a+t},easeIn:function(e,t,i,a){return i*(e/=a)*e+t},easeOut:function(e,t,i,a){return-i*(e/=a)*(e-2)+t},easeInOut:function(e,t,i,a){return(e/=a/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t}};const{requestAnimationFrameTool:g,isFunction:l,isTouchDevice:u}=a;class m{constructor(e={}){if(!document.createElement("canvas").getContext)return void window.alert("HTML5 Canvas is not supported in your browser.");const{canvasId:t,debug:i,width:n,height:r,highResolution:s,loadLimit:o,soundOn:h}=e;let p=n||window.innerWidth,c=r||window.innerHeight;this.canvas=document.getElementById(t),s&&(this.canvas.style.width=p+"px",this.canvas.style.height=c+"px",p*=2,c*=2),this.highResolution=s,this.canvas.width=p,this.canvas.height=c,this.width=this.canvas.width,this.height=this.canvas.height,this.calWidth=.5*this.width,this.calHeight=.5*this.height,this.debug=!!i,this.ctx=this.canvas.getContext("2d"),this.defaultLayer="default",this.layerArr=[this.defaultLayer],this.instancesObj={},this.instancesObj[this.defaultLayer]=[],this.instancesReactionArr=[],this.utils=a,this.customVariable={};const d=this;this.isTouchDevice=u(),this.debugArr=[],this.mixedpeeps=[],this.assetsObj={image:{},audio:{}},this.assetsCount={image:0,audio:0},this.assetsErrorQueue=[],this.assetsErrorCount=0,this.loadLimit=o||3,this.soundOn=!!h,this.fps=0,this.lastTime=0,this.lastPausedAt=0,this.pausedTime=0,this.paused=!1,this.timeMovement={},this.timeMovementStartArr=[],this.timeMovementFinishArr=[],this.keyUpListeners={},this.keyDownListeners={},this.keyPressListeners={},this.startAnimate=()=>{},this.paintUnderInstance=()=>{},this.paintAboveInstance=()=>{},this.endAnimate=()=>{},this.touchStartListener=()=>{},this.touchEndListener=()=>{},this.touchMoveListener=()=>{},document.addEventListener("keyup",e=>{d.keyListener(e,"keyup")},!1),document.addEventListener("keydown",e=>{d.keyListener(e,"keydown")},!1),document.addEventListener("keypress",e=>{d.keyListener(e,"keypress")},!1),this.isTouchDevice?(document.addEventListener("touchstart",e=>{d.touchStartListener(e)},!1),document.addEventListener("touchend",e=>{d.touchEndListener(e)},!1),document.addEventListener("touchmove",e=>{d.touchMoveListener(e)},!1)):(document.addEventListener("mousedown",e=>{d.touchStartListener(e)},!1),document.addEventListener("mouseup",e=>{d.touchEndListener(e)},!1),document.addEventListener("mousemove",e=>{d.touchMoveListener(e)},!1))}triggerReaction(e,t){let i=e,a=t;this.highResolution&&(i*=2,a*=2),this.instancesReactionArr.forEach(e=>{e.visible&&i>=e.x&&i<=e.x+e.width&&a>=e.y&&a<=e.y+e.height&&e.trigger(e,this)})}addAudio(e,t,i=0){if(!this.soundOn)return;i||(this.assetsCount.audio+=1);const a=new window.Audio;a.src=t,this.assetsObj.audio[e]=a,a.addEventListener("error",()=>{this.assetsErrorQueue.push({name:e,src:t,retry:i+1,type:"audio"})},!1),a.load()}getAudio(e){return this.assetsObj.audio[e]}playAudio(e,t=!1){if(!this.soundOn)return;const i=this.getAudio(e);if(i){if(i.play(),!t)return;i.addEventListener("ended",()=>{i.currentTime=0,i.play()},!1)}}pauseAudio(e){const t=this.getAudio(e);t&&t.pause()}setVariable(e,t){this.customVariable[e]=t}getVariable(e,t=null){const i=this.customVariable[e];return i||(null!==t?(this.setVariable(e,t),t):null)}addImg(e,t,i=0){i||(this.assetsCount.image+=1);const a=new window.Image;a.src=t,a.onload=()=>{this.assetsObj.image[e]=a},a.onerror=()=>{this.assetsErrorQueue.push({name:e,src:t,retry:i+1,type:"image"})}}getImg(e){return this.assetsObj.image[e]}animate(e){const t=e-this.pausedTime,i=this;this.paused?setTimeout(()=>{this.animate.call(i,t)},100):(this.tick(t),this.clean(),this.startAnimate(this,t),this.paintUnderInstance(this),this.updateInstances(t),this.paintInstances(),this.paintAboveInstance(),this.endAnimate(this,t),this.tickTimeMovement(),this.debug&&this.showFps(),this.debug&&this.drawDebug(),g(e=>{this.animate.call(i,e)}))}showFps(){this.ctx.save(),this.ctx.fillStyle="red",this.ctx.font=(this.highResolution?32:16)+"px Arial",this.ctx.fillText("FPS: "+this.fps.toFixed(),5,this.highResolution?40:20),this.ctx.restore()}debugLineX(e){this.debugArr.push({type:"lineX",y:e})}debugLineY(e){this.debugArr.push({type:"lineY",x:e})}debugDot(e,t){this.debugArr.push({type:"dot",x:e,y:t})}drawDebug(){this.debugArr.forEach(e=>{const{type:t,x:i,y:a}=e;switch(t){case"dot":this.drawDebugDot(i,a);break;case"lineX":this.drawDebugLine(null,a);break;case"lineY":this.drawDebugLine(i,null)}}),this.instancesReactionArr.forEach(e=>{e.visible&&(this.ctx.strokeStyle="red",this.ctx.beginPath(),this.ctx.rect(e.x,e.y,e.width,e.height),this.ctx.stroke())})}drawDebugLine(e,t){let i=[0,t],a=[this.width,t];e&&(i=[e,0],a=[e,this.height]),this.ctx.save(),this.ctx.strokeStyle="red",this.ctx.beginPath(),this.ctx.moveTo(...i),this.ctx.lineTo(...a),this.ctx.stroke(),this.ctx.restore()}drawDebugDot(e,t){this.ctx.save(),this.ctx.fillStyle="red",this.ctx.beginPath(),this.ctx.arc(e,t,2,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.beginPath(),this.ctx.arc(e,t,1,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.restore()}tick(e){this.updateFps(e),this.lastTime=e}updateFps(e){0===this.lastTime?this.fps=60:this.fps=1e3/(e-this.lastTime)}pixelsPerFrame(e){return e/this.fps}tickTimeMovement(){this.timeMovementStartArr.forEach(e=>{this.timeMovement[e].processing=!0}),this.timeMovementStartArr=[],this.timeMovementFinishArr.forEach(e=>{delete this.timeMovement[e]}),this.timeMovementFinishArr=[]}getTimeMovement(e,t,i,a={}){const{before:n,after:r}=a,s=d[a.easing||"linear"],o=a.name||"default",h=this.timeMovement[e];if(!h)return;h.processing||(this.timeMovementStartArr.push(e),h.store[o]=[],t.forEach(e=>{h.store[o].push({start:parseFloat(e[0]),end:parseFloat(e[1])})}),n&&n());const p=(e=!1)=>{const{duration:t}=h;let a=t;if(!e){const e=this.utils.getCurrentTime(),{startTime:t}=h;a=e-t}const n=h.store[o].map(e=>s(a,e.start,e.end-e.start,t));i.apply(this,n)};this.checkTimeMovement(e)?p():(this.timeMovementFinishArr.push(e),p(!0),r&&r())}checkTimeMovement(e){const t=this.timeMovement[e]||{};return this.utils.getCurrentTime()<=t.endTime}setTimeMovement(e,t){const i=this.utils.getCurrentTime();this.timeMovement[e]={startTime:i,endTime:i+t,duration:t,store:{}}}clean(){this.ctx.clearRect(0,0,this.width,this.height),this.debugArr=[]}addLayer(e){this.layerArr.push(e),this.instancesObj[e]=[]}removeLayer(e){this.layerArr=this.layerArr.filter(t=>t!==e),delete this.instancesObj[e]}swapLayer(e,t){this.utils.arraySwap(this.layerArr,e,t)}addInstance(e,t=this.defaultLayer){this.instancesObj[t].push(e),e.trigger&&this.instancesReactionArr.push(e)}getInstance(e,t=this.defaultLayer){return this.instancesObj[t].filter(t=>t.name===e)[0]}removeInstance(e,t=this.defaultLayer){const i=this.getInstance(e,t);i&&(this.instancesObj[t]=this.instancesObj[t].filter(t=>t.name!==e),i.trigger&&(this.instancesReactionArr=this.instancesReactionArr.filter(t=>t.name!==e)))}updateInstances(e){this.layerArr.forEach(t=>{this.instancesObj[t].forEach(t=>{t.update&&t.update(this,e)})})}paintInstances(){this.layerArr.forEach(e=>{this.instancesObj[e].forEach(e=>{e.paint&&e.paint(this)})})}togglePaused(){const e=this.utils.getCurrentTime();this.paused=!this.paused,this.paused?this.lastPausedAt=e:this.pausedTime+=e-this.lastPausedAt}addKeyUpListener(e,t){this.keyUpListeners[e]=t}addKeyDownListener(e,t){this.keyDownListeners[e]=t}addKeyPressListener(e,t){this.keyPressListeners[e]=t}findKeyListener(e,t){return"keyup"===t?this.keyUpListeners[e]:"keydown"===t?this.keyDownListeners[e]:this.keyPressListeners[e]}keyListener(e,t){let i;switch(e.keyCode){case 13:i="enter";break;case 32:i="space";break;case 37:i="leftArrow";break;case 39:i="rightArrow";break;case 38:i="upArrow";break;case 40:i="downArrow";break;default:i=e.keyCode}const a=this.findKeyListener(i,t);a&&a()}load(e,t){const i=setInterval(()=>{const a=this.assetsCount.image+this.assetsCount.audio,n=Object.keys(this.assetsObj.image).length+Object.keys(this.assetsObj.audio).length;t&&l(t)&&t({success:n,failed:this.assetsErrorCount,total:a}),this.assetsErrorQueue.length>0&&(this.assetsErrorQueue.forEach(e=>{const{retry:t,name:i,src:a,type:n}=e;t>=this.loadLimit?this.assetsErrorCount+=1:"image"===n?this.addImg(i,a,t):this.addAudio(i,a,t)}),this.assetsErrorQueue=[]),n===a&&(e&&l(e)?e():this.init(),clearInterval(i))},200)}init(){const e=this;g(t=>{this.animate.call(e,t)})}}class f{constructor(e={}){const{name:t,painter:i,action:a,trigger:n}=e;this.name=t,this.x=0,this.y=0,this.width=0,this.height=0,this.ax=0,this.ay=0,this.vx=0,this.vy=0,this.visible=!0,this.painter=i||null,this.action=a||null,this.trigger=n||null,this.ready=!1}paint(e){null!==this.painter&&this.visible&&this.painter(this,e)}update(e,t){null!==this.action&&this.action(this,e,t)}updateWidth(e){this.width=e,this.calWidth=e/2}updateHeight(e){this.height=e,this.calHeight=e/2}}var b="LAND",y="OUT",v=function(e){return e.checkTimeMovement("MOVE_DOWN_MOVEMENT")},T=function(e,t){var i=t?t.pixelsPerFrame:e.pixelsPerFrame.bind(e),a=e.getVariable("SUCCESS_COUNT"),n=2*e.getVariable("BLOCK_HEIGHT");return i(a<=4?1.25*n:n)},O=function(e,t){var i,a=e.getVariable("SUCCESS_COUNT"),n=e.getVariable("GAME_SCORE"),r=e.getVariable("GAME_USER_OPTION").hookSpeed;if(r)return r(a,n);switch(!0){case a<1:i=0;break;case a<10:i=1;break;case a<20:i=.8;break;case a<30:i=.7;break;default:i=.74}return e.getVariable("HARD_MODE")&&(i=1.1),Math.sin(t/(200/i))},x=function(e,t){var i=e.getVariable("SUCCESS_COUNT"),a=e.getVariable("GAME_SCORE"),n=e.getVariable("GAME_USER_OPTION").landBlockSpeed;if(n)return n(i,a);var r,s=e.width;switch(!0){case i<5:r=0;break;case i<13:r=.001;break;case i<23:r=.002;break;default:r=.003}return Math.cos(t/200)*r*s},E=function(e){return e.checkTimeMovement("HOOK_DOWN_MOVEMENT")?"HOOK_DOWN":e.checkTimeMovement("HOOK_UP_MOVEMENT")?"HOOK_UP":"HOOK_NORMAL"},w=function(e){if(e.getVariable("GAME_START_NOW")&&!(e.debug&&e.paused||"HOOK_NORMAL"!==E(e))){e.removeInstance("tutorial"),e.removeInstance("tutorial-arrow");var t=e.getInstance("block_".concat(e.getVariable("BLOCK_COUNT")));t&&"SWING"===t.status&&(e.setTimeMovement("HOOK_UP_MOVEMENT",500),t.status="BEFORE_DROP")}},A=function(e){var t=e.getVariable("GAME_USER_OPTION").setGameFailed,i=e.getVariable("FAILED_COUNT")+1;e.setVariable("FAILED_COUNT",i),e.setVariable("PERFECT_COUNT",0),t&&t(i),i>=3&&(e.pauseAudio("bgm"),e.playAudio("game-over"),e.setVariable("GAME_START_NOW",!1))},_=function(e,t){var i=e.getVariable("GAME_USER_OPTION"),a=i.setGameScore,n=i.successScore,r=i.perfectScore,s=e.getVariable("PERFECT_COUNT",0),o=t?s+1:0,h=e.getVariable("GAME_SCORE")+(n||25)+(r||25)*o;e.setVariable("GAME_SCORE",h),e.setVariable("PERFECT_COUNT",o),a&&a(h)},I=function(e,t){var i=t.string,a=t.size,n=t.x,r=t.y,s=t.textAlign,o=t.fontName,h=void 0===o?"wenxue":o,p=t.fontWeight,c=void 0===p?"normal":p,d=e.ctx,g=a,l=.1*g;d.save(),d.beginPath();var u=d.createLinearGradient(0,0,0,r);u.addColorStop(0,"#FAD961"),u.addColorStop(1,"#F76B1C"),d.fillStyle=u,d.lineWidth=l,d.strokeStyle="#FFF",d.textAlign=s||"center",d.font="".concat(c," ").concat(g,"px ").concat(h),d.strokeText(i,n,r),d.fillText(i,n,r),d.restore()},M=function(e,t,i){var a=t+1>=e.length?e.length-1:t,n=e[a],r=e[a+1>=e.length-1?a:a+1],s=function(e){var t=n[e],a=r[e];return Math.round(t+(a-t)*i)};return"rgb(".concat(s(0),", ").concat(s(1),", ").concat(s(2),")")},L=function(e){!function(e){var t=e.ctx.createLinearGradient(0,0,0,e.height),i=[[200,255,150],[105,230,240],[90,190,240],[85,100,190],[55,20,35],[75,25,35],[25,0,10]],a=e.getVariable("BACKGROUND_LINEAR_GRADIENT_OFFSET_HEIGHT",0);v(e)&&e.setVariable("BACKGROUND_LINEAR_GRADIENT_OFFSET_HEIGHT",a+1.5*T(e));var n=parseInt(a/e.height,10),r=a%e.height/e.height,s=M(i,n,r),o=M(i,n+1,r);t.addColorStop(0,o),t.addColorStop(1,s),e.ctx.fillStyle=t,e.ctx.beginPath(),e.ctx.rect(0,0,e.width,e.height),e.ctx.fill();var h=function(){e.ctx.fillStyle="rgba(255, 255, 255, 0.7)",e.ctx.fillRect(0,0,e.width,e.height)};e.getTimeMovement("LIGHTNING_MOVEMENT",[],(function(){}),{before:h,after:h})}(e),function(e){var t=e.getImg("background"),i=t.width,a=t.height*e.width/i,n=e.getVariable("BACKGROUND_IMG_OFFSET_HEIGHT",e.height-a);n>e.height||(e.getTimeMovement("MOVE_DOWN_MOVEMENT",[[n,n+T(e,{pixelsPerFrame:function(e){return e/2}})]],(function(e){n=e}),{name:"background"}),e.getTimeMovement("BG_INIT_MOVEMENT",[[n,n+a/4]],(function(e){n=e})),e.setVariable("BACKGROUND_IMG_OFFSET_HEIGHT",n),e.setVariable("LINE_INITIAL_OFFSET",e.height-.394*a),e.ctx.drawImage(t,0,n,e.width,a))}(e)},N=function(e,t,i){var a=e;a.ready||(a.y=t.getVariable("LINE_INITIAL_OFFSET"),a.ready=!0,a.collisionX=t.width-t.getVariable("BLOCK_WIDTH")),t.getTimeMovement("MOVE_DOWN_MOVEMENT",[[e.y,e.y+T(t,{pixelsPerFrame:function(e){return e/2}})]],(function(t){e.y=t}),{name:"line"});var n=x(t,i);e.x+=n,e.collisionX+=n},S=function(e,t){var i=t.ctx;t.debug&&(i.save(),i.beginPath(),i.strokeStyle="red",i.moveTo(e.x,e.y),i.lineTo(e.collisionX,e.y),i.lineWidth=1,i.stroke(),i.restore())},C=function(e){var t=e.count,i=function(e){return e[Math.floor(Math.random()*e.length)]};e.imgName=i(t>6?["c4","c5","c6","c7","c8"]:["c1","c2","c3"])},V=function(e,t){if(!e.ready){e.ready=!0,C(e),e.width=t.getVariable("CLOUD_SIZE"),e.height=t.getVariable("CLOUD_SIZE");var i=t.width,a=t.height,n=[{x:.1*i,y:.66*-a},{x:.65*i,y:.33*-a},{x:.1*i,y:0},{x:.65*i,y:.33*a}][e.index-1];e.x=t.utils.random(n.x,1.2*n.x),e.originX=e.x,e.ax=t.pixelsPerFrame(e.width*t.utils.random(.05,.08)*t.utils.randomPositiveNegative()),e.y=t.utils.random(n.y,1.2*n.y)}e.x+=e.ax,(e.x>=e.originX+e.width||e.x<=e.originX-e.width)&&(e.ax*=-1),v(t)&&(e.y+=1.2*T(t)),e.y>=t.height&&(e.y=.66*-t.height,e.count+=4,C(e))},k=function(e,t){var i=t.ctx,a=t.getImg(e.imgName);i.drawImage(a,e.x,e.y,e.width,e.height)},R=function(e,t,i){var a=t.getVariable("ROPE_HEIGHT");e.ready||(e.x=t.width/2,e.y=-1.5*a,e.ready=!0),t.getTimeMovement("HOOK_UP_MOVEMENT",[[e.y,e.y-a]],(function(t){e.y=t}),{after:function(){e.y=-1.5*a}}),t.getTimeMovement("HOOK_DOWN_MOVEMENT",[[e.y,e.y+a]],(function(t){e.y=t}),{name:"hook"});var n=t.getVariable("INITIAL_ANGLE");e.angle=n*O(t,i),e.weightX=e.x+Math.sin(e.angle)*a,e.weightY=e.y+Math.cos(e.angle)*a},F=function(e,t){var i=t.ctx,a=t.getVariable("ROPE_HEIGHT"),n=.1*a,r=t.getImg("hook");i.save(),i.translate(e.x,e.y),i.rotate(2*Math.PI-e.angle),i.translate(-e.x,-e.y),t.ctx.drawImage(r,e.x-n/2,e.y,n,a+5),i.restore()},P=function(e,t,i){var a=t.width,n=t.height,r=e.name;if(!e.ready){e.ready=!0;var s=.2*a;e.updateWidth(s),e.height=.46*s,e.x=t.calWidth-e.calWidth,e.y=.45*n,"tutorial"!==r&&(e.y+=1.2*e.height)}"tutorial"!==r&&(e.y+=Math.cos(i/200)*e.height*.01)},H=function(e,t){if(!t.checkTimeMovement("TUTORIAL_MOVEMENT")&&"HOOK_NORMAL"===E(t)){var i=t.ctx,a=e.name,n=t.getImg(a);i.drawImage(n,e.x,e.y,e.width,e.height)}},D=function(e,t){"ROTATE_LEFT"===e.status?e.y-e.width>=t.height&&(e.visible=!1,e.status=y,A(t)):e.y>=t.height&&(e.visible=!1,e.status=y,A(t))},G=function(e,t,i){var a=e,n=t.getVariable("ROPE_HEIGHT");if(a.visible){a.ready||(a.ready=!0,a.status="SWING",e.updateWidth(t.getVariable("BLOCK_WIDTH")),e.updateHeight(t.getVariable("BLOCK_HEIGHT")),e.x=t.width/2,e.y=-1.5*n);var r=t.getInstance("line");switch(a.status){case"SWING":t.getTimeMovement("HOOK_DOWN_MOVEMENT",[[e.y,e.y+n]],(function(t){e.y=t}),{name:"block"}),function(e,t,i){var a=t.getVariable("ROPE_HEIGHT");if("SWING"===e.status){var n=e,r=t.getVariable("INITIAL_ANGLE");n.angle=r*O(t,i),n.weightX=n.x+Math.sin(n.angle)*a,n.weightY=n.y+Math.cos(n.angle)*a}}(e,t,i);break;case"BEFORE_DROP":a.x=e.weightX-e.calWidth,a.y=e.weightY+.3*e.height,a.rotate=0,a.ay=t.pixelsPerFrame(3e-4*t.height),a.startDropTime=i,a.status="DROP";break;case"DROP":var s=i-a.startDropTime;a.startDropTime=i,a.vy+=a.ay*s,a.y+=a.vy*s+.5*a.ay*Math.pow(s,2);var o=function(e,t){return e.y+e.height>=t.y?e.x<t.x-e.calWidth||e.x>t.collisionX+e.calWidth?1:e.x<t.x?2:e.x>t.collisionX?3:e.x>t.x+.8*e.calWidth&&e.x<t.x+1.2*e.calWidth?5:4:0}(e,r),h=r.y-e.height,p=function(e){e.originOutwardAngle=Math.atan(e.height/e.outwardOffset),e.originHypotenuse=Math.sqrt(Math.pow(e.height,2)+Math.pow(e.outwardOffset,2)),t.playAudio("rotate")};switch(o){case 1:D(e,t);break;case 2:a.status="ROTATE_LEFT",e.y=h,e.outwardOffset=r.x+e.calWidth-e.x,p(e);break;case 3:a.status="ROTATE_RIGHT",e.y=h,e.outwardOffset=r.collisionX+e.calWidth-e.x,p(e);break;case 4:case 5:a.status=b;var c=t.getVariable("SUCCESS_COUNT");!function(e){var t=e.getVariable("GAME_USER_OPTION").setGameSuccess,i=e.getVariable("SUCCESS_COUNT")+1;e.setVariable("SUCCESS_COUNT",i),e.getVariable("HARD_MODE")&&e.setVariable("ROPE_HEIGHT",e.height*e.utils.random(.35,.55)),t&&t(i)}(t),t.setTimeMovement("MOVE_DOWN_MOVEMENT",500),10!==c&&15!==c||t.setTimeMovement("LIGHTNING_MOVEMENT",150),e.y=h,r.y=h,r.x=a.x-a.calWidth,r.collisionX=r.x+a.width;var d=.3*a.width;(a.x>t.width-2*d||a.x<-d)&&t.setVariable("HARD_MODE",!0),5===o?(e.perfect=!0,_(t,!0),t.playAudio("drop-perfect")):(_(t),t.playAudio("drop"))}break;case b:t.getTimeMovement("MOVE_DOWN_MOVEMENT",[[e.y,e.y+T(t,{pixelsPerFrame:function(e){return e/2}})]],(function(i){e.visible&&(e.y=i,e.y>t.height&&(e.visible=!1))}),{name:e.name}),e.x+=x(t,i);break;case"ROTATE_LEFT":case"ROTATE_RIGHT":var g="ROTATE_RIGHT"===a.status,l=t.pixelsPerFrame(4*Math.PI),u=g?1:-1;if(g?e.rotate>1.3:e.rotate<-1.3)e.rotate+=l/8*u,e.y+=t.pixelsPerFrame(.7*t.height),e.x+=t.pixelsPerFrame(.3*t.width)*u;else{var m=(e.calWidth-e.outwardOffset)/e.calWidth;m=m>.5?m:.5,e.rotate+=l*m*u;var f=e.originOutwardAngle+e.rotate,y=g?r.collisionX+e.calWidth:r.x+e.calWidth,v=r.y;e.x=y-Math.cos(f)*e.originHypotenuse,e.y=v-Math.sin(f)*e.originHypotenuse}D(e,t)}}},U=function(e,t){var i=e.perfect,a=e.name,n=a.substr(a.indexOf("_")+1)%t.mixedpeeps.length,r=t.getImg(i?"block-perfect":"block"),s=t.getImg("peep"+n);console.log("peep"+n),console.log(s.src),t.setVariable("DEBUG",n),t.ctx.drawImage(r,e.x,e.y,e.width,e.height),t.ctx.drawImage(s,e.x+.15*e.width,e.y+.05*e.height,.7*e.width,.7*e.height),console.log(t.mixedpeeps[n]),K(t,{string:t.mixedpeeps[n],size:.17*e.width,x:e.x+e.width/2,y:e.y+.98*e.height,textAlign:"center",fontName:"Arial",fontWeight:"bold"})},W=function(e,t){switch(e.status){case"SWING":!function(e,t){var i=t.getImg("blockRope"),a=e.name,n=a.substr(a.indexOf("_")+1)%t.mixedpeeps.length,r=t.getImg("peep"+n);t.ctx.drawImage(i,e.weightX-e.calWidth,e.weightY,e.width,1.3*e.height),t.ctx.drawImage(r,e.weightX-e.calWidth+.15*e.width,e.weightY+.35*e.height,.7*e.width,.7*e.height),K(t,{string:t.mixedpeeps[n],size:.17*e.width,x:e.weightX-e.calWidth+e.width/2,y:e.weightY+1.3*e.height*.98,textAlign:"center",fontName:"Arial",fontWeight:"bold"});var s=e.weightX-e.calWidth;t.debugLineY(s)}(e,t);break;case"DROP":case b:U(e,t);break;case"ROTATE_LEFT":case"ROTATE_RIGHT":!function(e,t){var i=t.ctx;i.save(),i.translate(e.x,e.y),i.rotate(e.rotate),i.translate(-e.x,-e.y),U(e,t),i.restore()}(e,t)}},K=function(e,t){var i=t.string,a=t.size,n=t.x,r=t.y,s=t.textAlign,o=t.fontName,h=void 0===o?"wenxue":o,p=t.fontWeight,c=void 0===p?"normal":p,d=e.ctx,g=a,l=.1*g;d.save(),d.beginPath();var u=d.createLinearGradient(0,0,0,r);u.addColorStop(0,"#FFFFFF"),u.addColorStop(1,"#FFEEAA"),d.fillStyle=u,d.lineWidth=l,d.strokeStyle="#000",d.textAlign=s||"center",d.font="".concat(c," ").concat(g,"px ").concat(h),d.strokeText(i,n,r),d.fillText(i,n,r),d.restore()},B=function(e,t){var i=e.visible,a=e.ready,n=e.type;if(i){var r=t.getVariable("CLOUD_SIZE");if(!a){var s=function(e,t){var i=e.width,a=e.height,n=e.utils.random,r=e.getVariable("CLOUD_SIZE");return{bottomToTop:{x:i*n(.3,.7),y:a,vx:0,vy:.7*e.pixelsPerFrame(a)*-1},leftToRight:{x:-1*r,y:a*n(.3,.6),vx:.4*e.pixelsPerFrame(i),vy:.1*e.pixelsPerFrame(a)*-1},rightToLeft:{x:i,y:a*n(.2,.5),vx:.4*e.pixelsPerFrame(i)*-1,vy:.1*e.pixelsPerFrame(a)},rightTopToLeft:{x:i,y:0,vx:.6*e.pixelsPerFrame(i)*-1,vy:.5*e.pixelsPerFrame(a)}}[t]}(t,n);e.ready=!0,e.width=r,e.height=r,e.x=s.x,e.y=s.y,e.vx=s.vx,e.vy=s.vy}e.x+=e.vx,e.y+=e.vy,(e.y+r<0||e.y>t.height||e.x+r<0||e.x>t.width)&&(e.visible=!1)}},j=function(e,t){var i=t.ctx,a=t.getImg(e.imgName);i.drawImage(a,e.x,e.y,e.width,e.height)},X=function(e,t,i){if(e.getVariable("FLIGHT_COUNT")!==t){var a=new f({name:"flight_".concat(t),action:B,painter:j});a.imgName="f".concat(t),a.type=i,e.addInstance(a,"FLIGHT_LAYER"),e.setVariable("FLIGHT_COUNT",t)}},Y=function(e){if(e.getVariable("GAME_START_NOW")){var t=e.getVariable("SUCCESS_COUNT",0),i=e.getVariable("DEBUG",0),a=e.getVariable("FAILED_COUNT"),n=e.getVariable("GAME_SCORE",0),r=Number(t)>99?.1*e.width:0;I(e,{string:"floor",size:.06*e.width,x:.24*e.width+r,y:.12*e.width,textAlign:"left",fontName:"Arial",fontWeight:"bold"}),I(e,{string:t,size:.17*e.width,x:.22*e.width+r,y:.2*e.width,textAlign:"right"}),I(e,{string:i,size:.05*e.width,x:.3*e.width+r,y:.2*e.width,textAlign:"left"});var s=e.getImg("score"),o=s.width,h=s.height,p=.35*e.width,c=h*p/o;e.ctx.drawImage(s,.61*e.width,.038*e.width,p,c),I(e,{string:n,size:.06*e.width,x:.9*e.width,y:.11*e.width,textAlign:"right"});for(var d=e.ctx,g=e.getImg("heart"),l=g.width,u=g.height,m=.08*e.width,f=u*m/l,b=1;b<=3;b+=1)d.save(),b<=a&&(d.globalAlpha=.2),d.drawImage(g,.66*e.width+(b-1)*m,.16*e.width,m,f),d.restore()}},z=function(e){if(e.getVariable("GAME_START_NOW")){var t=e.getInstance("block_".concat(e.getVariable("BLOCK_COUNT")));if(!t||[b,y].indexOf(t.status)>-1){if(v(e)&&T(e))return;if(e.checkTimeMovement("HOOK_UP_MOVEMENT"))return;var i=function(e){var t=e.getVariable("SUCCESS_COUNT"),i=e.getVariable("GAME_SCORE"),a=e.getVariable("GAME_USER_OPTION").hookAngle;if(a)return a(t,i);if(e.getVariable("HARD_MODE"))return 90;switch(!0){case t<10:return 30;case t<20:return 60;default:return 80}}(e),a=Math.PI*e.utils.random(i,i+5)*e.utils.randomPositiveNegative()/180;e.setVariable("BLOCK_COUNT",e.getVariable("BLOCK_COUNT")+1),e.setVariable("INITIAL_ANGLE",a),e.setTimeMovement("HOOK_DOWN_MOVEMENT",500);var n=new f({name:"block_".concat(e.getVariable("BLOCK_COUNT")),action:G,painter:W});e.addInstance(n)}switch(Number(e.getVariable("SUCCESS_COUNT",0))){case 2:X(e,1,"leftToRight");break;case 6:X(e,2,"rightToLeft");break;case 8:X(e,3,"leftToRight");break;case 14:X(e,4,"bottomToTop");break;case 18:X(e,5,"bottomToTop");break;case 22:X(e,6,"bottomToTop");break;case 25:X(e,7,"rightTopToLeft")}}};window.TowerGame=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.width,i=e.height,a=e.canvasId,n=e.soundOn,r=new m({canvasId:a,highResolution:!0,width:t,height:i,soundOn:n}),s=function(e){return"./assets/".concat(e)},o=[];o[0]="Abel",o[1]="Aiden",o[2]="Aimee",o[3]="Alex",o[4]="Alexis",o[5]="Amanuel",o[6]="Andrew",o[7]="Andrew",o[8]="Andrii",o[9]="Anshu",o[10]="Anton",o[11]="Arian",o[12]="Leah,Ashley,Hika",o[13]="August",o[14]="Austin",o[15]="Avalyn",o[16]="Besufekad",o[17]="Bixby",o[18]="Carson",o[19]="Cecelia Rose",o[20]="Charles",o[21]="Charles",o[22]="Clover",o[23]="Cole",o[24]="Colin",o[25]="Corin",o[26]="David",o[27]="Derek",o[28]="Dylan",o[29]="Dylan",o[30]="Ej",o[31]="Elijah",o[32]="Emilie",o[33]="Enbry",o[34]="Finn",o[35]="Francisco",o[36]="Frenki",o[37]="Gabe",o[38]="Gavin",o[39]="Guillermo",o[40]="Habon",o[41]="Hannah",o[42]="Hayat",o[43]="Hika",o[44]="Himnish",o[45]="Holland",o[46]="Isaiah",o[47]="Isaiah",o[48]="Jacob",o[49]="James",o[50]="Japheth",o[51]="Jaxon",o[52]="Jeremy",o[53]="Jonathan",o[54]="Josh",o[55]="Kalkidan",o[56]="Katelyn",o[57]="Katie",o[58]="Kenji",o[59]="Kenneth",o[60]="Larsen",o[61]="Matthew",o[62]="Leonardo",o[63]="Liam",o[64]="Lily",o[65]="Luca",o[66]="Luis",o[67]="Luis",o[68]="Madelyn",o[69]="Mai",o[70]="Marcos",o[71]="Md Nazmul",o[72]="Mektub",o[73]="Mercedes",o[74]="Mia",o[75]="Miles",o[76]="Nafiur",o[77]="Natan",o[78]="Natasha",o[79]="Oliver",o[80]="Otto",o[81]="Owen",o[82]="Preston",o[83]="Quang-Hy",o[84]="Roel",o[85]="Ron",o[86]="Rosa",o[87]="Ryan",o[88]="Sal",o[89]="Sally",o[90]="Sam",o[91]="Sashti",o[92]="Sequoia",o[93]="Serena",o[94]="Siri",o[95]="Sydney",o[96]="Theliza",o[97]="Tiffany",o[98]="Tram-Anh",o[99]="Tyler",o[100]="Van",o[101]="Victor",o[102]="Walter",o[103]="William",o[104]="Yonatan";var h=[];h[0]="peep0.png",h[1]="peep1.png",h[2]="peep2.png",h[3]="peep3.png",h[4]="peep4.png",h[5]="peep5.png",h[6]="peep6.png",h[7]="peep7.png",h[8]="peep8.png",h[9]="peep9.png",h[10]="peep10.png",h[11]="peep11.png",h[12]="peep12.png",h[13]="peep13.png",h[14]="peep14.png",h[15]="peep15.png",h[16]="peep16.png",h[17]="peep17.png",h[18]="peep18.png",h[19]="peep19.png",h[20]="peep20.png",h[21]="peep21.png",h[22]="peep22.png",h[23]="peep23.png",h[24]="peep24.png",h[25]="peep25.png",h[26]="peep26.png",h[27]="peep27.png",h[28]="peep28.png",h[29]="peep29.png",h[30]="peep30.png",h[31]="peep31.png",h[32]="peep32.png",h[33]="peep33.png",h[34]="peep34.png",h[35]="peep35.png",h[36]="peep36.png",h[37]="peep37.png",h[38]="peep38.png",h[39]="peep39.png",h[40]="peep40.png",h[41]="peep41.png",h[42]="peep42.png",h[43]="peep43.png",h[44]="peep44.png",h[45]="peep45.png",h[46]="peep46.png",h[47]="peep47.png",h[48]="peep48.png",h[49]="peep49.png",h[50]="peep50.png",h[51]="peep51.png",h[52]="peep52.png",h[53]="peep53.png",h[54]="peep54.png",h[55]="peep55.png",h[56]="peep56.png",h[57]="peep57.png",h[58]="peep58.png",h[59]="peep59.png",h[60]="peep60.png",h[61]="peep61.png",h[62]="peep62.png",h[63]="peep63.png",h[64]="peep64.png",h[65]="peep65.png",h[66]="peep66.png",h[67]="peep67.png",h[68]="peep68.png",h[69]="peep69.png",h[70]="peep70.png",h[71]="peep71.png",h[72]="peep72.png",h[73]="peep73.png",h[74]="peep74.png",h[75]="peep75.png",h[76]="peep76.png",h[77]="peep77.png",h[78]="peep78.png",h[79]="peep79.png",h[80]="peep80.png",h[81]="peep81.png",h[82]="peep82.png",h[83]="peep83.png",h[84]="peep84.png",h[85]="peep85.png",h[86]="peep86.png",h[87]="peep87.png",h[88]="peep88.png",h[89]="peep89.png",h[90]="peep90.png",h[91]="peep91.png",h[92]="peep92.png",h[93]="peep93.png",h[94]="peep94.png",h[95]="peep95.png",h[96]="peep96.png",h[97]="peep97.png",h[98]="peep98.png",h[99]="peep99.png",h[100]="peep100.png",h[101]="peep101.png",h[102]="peep102.png",h[103]="peep103.png",h[104]="peep104.png";for(var p=0;o.length>0;){var c=Math.floor(Math.random()*o.length);r.mixedpeeps[p]=o[c],r.addImg("peep"+p,s(h[c])),console.log(p+":"+c+":peep"+p+":"+h[c]+":"+r.mixedpeeps[p]),o.splice(c,1),h.splice(c,1),p++}r.addImg("background",s("background.png")),r.addImg("hook",s("hook.png")),r.addImg("blockRope",s("block-rope.png")),r.addImg("block",s("block.png")),r.addImg("block-perfect",s("block-perfect.png"));for(var d=1;d<=8;d+=1)r.addImg("c".concat(d),s("c".concat(d,".png")));r.addLayer("FLIGHT_LAYER");for(var g=1;g<=7;g+=1)r.addImg("f".concat(g),s("f".concat(g,".png")));r.swapLayer(0,1),r.addImg("tutorial",s("tutorial.png")),r.addImg("tutorial-arrow",s("tutorial-arrow.png")),r.addImg("heart",s("heart.png")),r.addImg("score",s("score.png")),r.addAudio("drop-perfect",s("drop-perfect.mp3")),r.addAudio("drop",s("drop.mp3")),r.addAudio("game-over",s("game-over.mp3")),r.addAudio("rotate",s("rotate.mp3")),r.addAudio("bgm",s("bgm.mp3")),r.setVariable("BLOCK_WIDTH",.25*r.width),r.setVariable("BLOCK_HEIGHT",.71*r.getVariable("BLOCK_WIDTH")),r.setVariable("CLOUD_SIZE",.3*r.width),r.setVariable("ROPE_HEIGHT",.4*r.height),r.setVariable("BLOCK_COUNT",0),r.setVariable("SUCCESS_COUNT",0),r.setVariable("FAILED_COUNT",0),r.setVariable("GAME_SCORE",0),r.setVariable("HARD_MODE",!1),r.setVariable("GAME_USER_OPTION",e);for(var l=1;l<=4;l+=1){var u=new f({name:"cloud_".concat(l),action:V,painter:k});u.index=l,u.count=5-l,r.addInstance(u)}var b=new f({name:"line",action:N,painter:S});r.addInstance(b);var y=new f({name:"hook",action:R,painter:F});return r.addInstance(y),r.startAnimate=z,r.endAnimate=Y,r.paintUnderInstance=L,r.addKeyDownListener("enter",(function(){r.debug&&r.togglePaused()})),r.touchStartListener=function(){w(r)},r.playBgm=function(){r.playAudio("bgm",!0)},r.pauseBgm=function(){r.pauseAudio("bgm")},r.start=function(){var e=new f({name:"tutorial",action:P,painter:H});r.addInstance(e);var t=new f({name:"tutorial-arrow",action:P,painter:H});r.addInstance(t),r.setTimeMovement("BG_INIT_MOVEMENT",500),r.setTimeMovement("TUTORIAL_MOVEMENT",500),r.setVariable("GAME_START_NOW",!0)},r}}]);